<!DOCTYPE html>
<html lang="de">
<head>
<meta charset="UTF-8">
<title>GoW Farbverlauf Tool</title>
<style>
  body { font-family:sans-serif; background:#111; color:#eee; padding:20px }
  textarea, select, input { width:100%; margin:6px 0; padding:6px }
  .preview { margin-top:15px; font-size:1.2em; white-space:pre-wrap }
  .box { margin-top:10px; background:#222; padding:10px; font-family:monospace }
  .counter { margin-top:8px; font-weight:bold }
  .bad { color:#ff5555 }
  .ok { color:#66ff99 }
</style>
</head>
<body>

<h2>Gems of War – Farbtext</h2>

<textarea id="text" rows="3">Guten Morgen und fröhliches Verdammnisse kloppen :D</textarea>

<label>Startfarbe</label>
<input type="color" id="start" value="#00ffff">

<label>Endfarbe</label>
<input type="color" id="end" value="#ff00ff">

<label>Modus</label>
<select id="mode">
  <option value="char">Jeder Buchstabe</option>
  <option value="2char">Alle 2 Buchstaben</option>
  <option value="word">Jedes Wort</option>
</select>

<button onclick="render()">Aktualisieren</button>

<div class="counter" id="count"></div>
<div class="preview" id="preview"></div>
<div class="box" id="output"></div>

<script>
const LIMIT = 243

function hex(c){return Math.round(c).toString(16).padStart(2,'0')}
function lerp(a,b,t){return a+(b-a)*t}

function build(text, mode, start, end){
  let units=[]
  if(mode==="word") units=text.split(/(\s+)/)
  else if(mode==="2char") units=text.match(/.{1,2}/g)
  else units=[...text]

  const colored = units.filter(u=>!u.match(/^\s+$/))
  let i=0, out="", prev=""

  units.forEach(u=>{
    if(u.match(/^\s+$/)){ out+=u; prev+=u; return }
    const t=i/(colored.length-1||1)
    const r=hex(lerp(start[0],end[0],t))
    const g=hex(lerp(start[1],end[1],t))
    const b=hex(lerp(start[2],end[2],t))
    out+=`[${r}${g}${b}]${u}`
    prev+=`<span style="color:#${r}${g}${b}">${u}</span>`
    i++
  })
  return {out, prev}
}

function render(){
  const text = document.getElementById('text').value
  const start = document.getElementById('start').value.match(/\w\w/g).map(x=>parseInt(x,16))
  const end = document.getElementById('end').value.match(/\w\w/g).map(x=>parseInt(x,16))
  let mode = document.getElementById('mode').value

  let result = build(text, mode, start, end)

  // Auto-Optimierung
  if(result.out.length > LIMIT && mode==="char"){
    mode="2char"
    result = build(text, mode, start, end)
  }
  if(result.out.length > LIMIT && mode==="2char"){
    mode="word"
    result = build(text, mode, start, end)
  }
  if(result.out.length > LIMIT){
    // alles ein Block
    result.out = `[${document.getElementById('start').value.slice(1)}]` + text
    result.prev = `<span style="color:${document.getElementById('start').value}">${text}</span>`
  }

  document.getElementById('output').textContent = result.out
  document.getElementById('preview').innerHTML = result.prev

  const c = result.out.length
  const counter = document.getElementById('count')
  counter.textContent = `Zeichen: ${c} / ${LIMIT}`
  counter.className = "counter " + (c>LIMIT ? "bad":"ok")
}

render()
</script>
</body>
</html>
