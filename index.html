<!DOCTYPE html>
<html lang="de">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>GoW Farbverlauf Tool</title>
<style>
  body { font-family: sans-serif; background: #111; color: #eee; padding: 20px; display: flex; flex-direction: column; align-items: center; }
  .container { width: 100%; max-width: 800px; }
  textarea, select, input { width: 100%; margin: 6px 0; padding: 10px; border-radius: 4px; border: 1px solid #444; background: #222; color: #fff; box-sizing: border-box; }
  label { display: block; margin-top: 15px; font-size: 0.9em; color: #aaa; }
  .preview { margin-top: 20px; font-size: 1.4em; white-space: pre-wrap; font-weight: bold; text-align: center; min-height: 1.5em; }
  
  .output-wrapper { position: relative; margin-top: 15px; }
  .box { 
    background: #000; padding: 15px; font-family: monospace; border: 1px dashed #555; 
    word-break: break-all; cursor: pointer; transition: background 0.2s;
  }
  .box:hover { background: #1a1a1a; }
  .box:active { background: #333; }
  
  .copy-btn { 
    width: 100%; margin-top: 10px; padding: 12px; background: #444; color: white; 
    border: none; border-radius: 4px; cursor: pointer; font-weight: bold; text-transform: uppercase;
  }
  .copy-btn:hover { background: #666; }
  
  .counter { margin-top: 15px; font-weight: bold; text-align: right; }
  .bad { color: #ff5555; }
  .ok { color: #66ff99; }
</style>
</head>
<body>

<div class="container">
  <h2>Gems of War – Farbtext</h2>

  <label>Dein Text</label>
  <textarea id="text" rows="3" oninput="render()">Guten Morgen!</textarea>

  <label>Startfarbe</label>
  <input type="color" id="start" value="#00ffff" oninput="render()">

  <label>Endfarbe</label>
  <input type="color" id="end" value="#ff00ff" oninput="render()">

  <label>Modus</label>
  <select id="mode" onchange="render()">
    <option value="char">Jeder Buchstabe (Schönster Verlauf)</option>
    <option value="2char">Alle 2 Buchstaben (Spart Platz)</option>
    <option value="word">Jedes Wort (Ganz sparsam)</option>
  </select>

  <div class="counter" id="count"></div>
  
  <div class="preview" id="preview"></div>

  <div class="output-wrapper">
    <div class="box" id="output" onclick="copyToClipboard()" title="Klicken zum Kopieren"></div>
    <button class="copy-btn" onclick="copyToClipboard()">Code Kopieren</button>
  </div>
</div>

<script>
const LIMIT = 243;

function hex(c){return Math.round(c).toString(16).padStart(2,'0')}
function lerp(a,b,t){return a+(b-a)*t}

function build(text, mode, start, end){
  let units=[];
  if(mode==="word") units=text.split(/(\s+)/);
  else if(mode==="2char") units=text.match(/.{1,2}/g) || [];
  else units=[...text];

  const colored = units.filter(u=>!u.match(/^\s+$/));
  let i=0, out="", prev="";

  units.forEach(u=>{
    if(u.match(/^\s+$/)){ out+=u; prev+=u; return; }
    const t=i/(colored.length-1||1);
    const r=hex(lerp(start[0],end[0],t));
    const g=hex(lerp(start[1],end[1],t));
    const b=hex(lerp(start[2],end[2],t));
    out+=`[${r}${g}${b}]${u}`;
    prev+=`<span style="color:#${r}${g}${b}">${u}</span>`;
    i++;
  });
  return {out, prev};
}

function render(){
  const text = document.getElementById('text').value;
  const start = document.getElementById('start').value.match(/\w\w/g).map(x=>parseInt(x,16));
  const end = document.getElementById('end').value.match(/\w\w/g).map(x=>parseInt(x,16));
  let mode = document.getElementById('mode').value;

  let result = build(text, mode, start, end);

  // Auto-Kompression falls zu lang
  if(result.out.length > LIMIT && mode==="char"){
    mode="2char";
    result = build(text, mode, start, end);
  }
  if(result.out.length > LIMIT && mode==="2char"){
    mode="word";
    result = build(text, mode, start, end);
  }
  if(result.out.length > LIMIT){
    result.out = `[${document.getElementById('start').value.slice(1)}]` + text;
    result.prev = `<span style="color:${document.getElementById('start').value}">${text}</span>`;
  }

  document.getElementById('output').textContent = result.out;
  document.getElementById('preview').innerHTML = result.prev;

  const c = result.out.length;
  const counter = document.getElementById('count');
  counter.textContent = `Zeichen: ${c} / ${LIMIT}`;
  counter.className = "counter " + (c>LIMIT ? "bad":"ok");
}

function copyToClipboard() {
  const text = document.getElementById('output').textContent;
  navigator.clipboard.writeText(text).then(() => {
    const btn = document.querySelector('.copy-btn');
    const oldText = btn.textContent;
    btn.textContent = "KOPIERT! ✓";
    btn.style.background = "#28a745";
    setTimeout(() => {
      btn.textContent = oldText;
      btn.style.background = "#444";
    }, 2000);
  });
}

// Initialer Aufruf
render();
</script>
</body>
</html>
