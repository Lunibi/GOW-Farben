<!DOCTYPE html>
<html lang="de">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>GoW Farbverlauf Tool</title>
<style>
  body { font-family: sans-serif; background: #111; color: #eee; padding: 20px; display: flex; flex-direction: column; align-items: center; }
  .container { width: 100%; max-width: 600px; }
  textarea, select { width: 100%; margin: 6px 0; padding: 10px; border-radius: 4px; border: 1px solid #444; background: #222; color: #fff; box-sizing: border-box; resize: vertical; }
  .color-row { display: flex; gap: 20px; justify-content: center; margin: 15px 0; }
  .color-item { display: flex; flex-direction: column; align-items: center; flex: 1; }
  input[type="color"] { -webkit-appearance: none; border: 2px solid #444; width: 60px; height: 60px; cursor: pointer; background: none; border-radius: 8px; padding: 0; }
  input[type="color"]::-webkit-color-swatch-wrapper { padding: 0; }
  input[type="color"]::-webkit-color-swatch { border: none; border-radius: 6px; }
  label { display: block; margin-bottom: 5px; font-size: 0.85em; color: #aaa; text-transform: uppercase; }
  .preview { margin-top: 20px; font-size: 1.4em; white-space: pre-wrap; font-weight: bold; text-align: center; min-height: 1.5em; text-shadow: 1px 1px 2px #000; }
  .output-wrapper { position: relative; margin-top: 15px; }
  .box { background: #000; padding: 15px; font-family: monospace; border: 1px dashed #555; word-break: break-all; cursor: pointer; transition: background 0.2s; font-size: 0.9em; min-height: 20px; }
  .box:hover { background: #1a1a1a; }
  .copy-btn { width: 100%; margin-top: 10px; padding: 12px; background: #444; color: white; border: none; border-radius: 4px; cursor: pointer; font-weight: bold; }
  .counter { margin-top: 15px; font-weight: bold; text-align: right; font-size: 0.9em; }
  .bad { color: #ff5555; }
  .ok { color: #66ff99; }
</style>
</head>
<body>

<div class="container">
  <h2 style="text-align: center;">Gems of War – Farbtext</h2>

  <label>Dein Text</label>
  <textarea id="text" rows="3" oninput="saveAndRender()" placeholder="Hier Text eingeben..."></textarea>

  <div class="color-row">
    <div class="color-item">
      <label>Start</label>
      <input type="color" id="start" value="#00ffff" oninput="saveAndRender()">
    </div>
    <div class="color-item">
      <label>Ende</label>
      <input type="color" id="end" value="#ff00ff" oninput="saveAndRender()">
    </div>
  </div>

  <label>Modus</label>
  <select id="mode" onchange="saveAndRender()">
    <option value="char">Jeder Buchstabe</option>
    <option value="2char">Alle 2 Buchstaben</option>
    <option value="word">Jedes Wort</option>
  </select>

  <div class="counter" id="count"></div>
  <div class="preview" id="preview"></div>

  <div class="output-wrapper">
    <div class="box" id="output" onclick="copyToClipboard()"></div>
    <button class="copy-btn" id="copyBtn" onclick="copyToClipboard()">CODE KOPIEREN</button>
  </div>
</div>

<script>
const LIMIT = 243;

function hex(c){return Math.round(c).toString(16).padStart(2,'0')}
function lerp(a,b,t){return a+(b-a)*t}

function build(text, mode, start, end){
  if(!text) return {out: "", prev: ""};
  let units=[];
  if(mode==="word") units=text.split(/(\s+)/);
  else if(mode==="2char") units=text.match(/.{1,2}/g) || [];
  else units=[...text];

  const colored = units.filter(u=>!u.match(/^\s+$/));
  let i=0, out="", prev="";

  units.forEach(u=>{
    if(u.match(/^\s+$/)){ out+=u; prev+=u; return; }
    const t=i/(colored.length-1||1);
    const r=hex(lerp(start[0],end[0],t));
    const g=hex(lerp(start[1],end[1],t));
    const b=hex(lerp(start[2],end[2],t));
    out+=`[${r}${g}${b}]${u}`;
    prev+=`<span style="color:#${r}${g}${b}">${u}</span>`;
    i++;
  });
  return {out, prev};
}

// Speichert alle Werte und rendert neu
function saveAndRender() {
  localStorage.setItem('gow_text', document.getElementById('text').value);
  localStorage.setItem('gow_start', document.getElementById('start').value);
  localStorage.setItem('gow_end', document.getElementById('end').value);
  localStorage.setItem('gow_mode', document.getElementById('mode').value);
  render();
}

function render(){
  const text = document.getElementById('text').value;
  const startHex = document.getElementById('start').value;
  const endHex = document.getElementById('end').value;
  
  const start = startHex.match(/\w\w/g).map(x=>parseInt(x,16));
  const end = endHex.match(/\w\w/g).map(x=>parseInt(x,16));
  let mode = document.getElementById('mode').value;

  let result = build(text, mode, start, end);

  // Auto-Optimierung
  if(result.out.length > LIMIT && mode==="char"){
    mode="2char";
    result = build(text, mode, start, end);
  }
  if(result.out.length > LIMIT && mode==="2char"){
    mode="word";
    result = build(text, mode, start, end);
  }
  if(result.out.length > LIMIT){
    result.out = `[${startHex.slice(1)}]` + text;
    result.prev = `<span style="color:${startHex}">${text}</span>`;
  }

  document.getElementById('output').textContent = result.out;
  document.getElementById('preview').innerHTML = result.prev;

  const c = result.out.length;
  const counter = document.getElementById('count');
  counter.textContent = `Zeichen: ${c} / ${LIMIT}`;
  counter.className = "counter " + (c>LIMIT ? "bad":"ok");
}

function copyToClipboard() {
  const text = document.getElementById('output').textContent;
  if(!text) return;
  navigator.clipboard.writeText(text).then(() => {
    const btn = document.getElementById('copyBtn');
    const oldText = btn.textContent;
    btn.textContent = "KOPIERT! ✓";
    btn.style.background = "#28a745";
    setTimeout(() => {
      btn.textContent = oldText;
      btn.style.background = "#444";
    }, 2000);
  });
}

// Lädt alle gespeicherten Einstellungen beim Start
function loadSettings() {
  const sText = localStorage.getItem('gow_text');
  const sStart = localStorage.getItem('gow_start');
  const sEnd = localStorage.getItem('gow_end');
  const sMode = localStorage.getItem('gow_mode');

  if (sText !== null) document.getElementById('text').value = sText;
  if (sStart !== null) document.getElementById('start').value = sStart;
  if (sEnd !== null) document.getElementById('end').value = sEnd;
  if (sMode !== null) document.getElementById('mode').value = sMode;
  
  render();
}

loadSettings();
</script>
</body>
</html>
